# Changelog — v0.1 (Planned)

**Status:** In development (Iteration 2/8 complete)
**Target Release Date:** TBD
**Last Updated:** 2025-11-17

---

## Overview

Version 0.1 is the initial release of Dictate-to-Clipboard, providing core offline dictation functionality with a portable, admin-free Windows desktop app.

**Tagline:** Hold hotkey → speak → release → transcript in clipboard.

---

## Iterations Completed

### Iteration 1: Hotkey & App Skeleton ✅ COMPLETE

**Implemented:**
- ✅ US-001: Hotkey toggles state (FR-010, UC-001)
  - State machine with 3 states: Idle → Recording → Processing → Idle
  - Global hotkey registration via Win32 RegisterHotKey API
  - State transitions logged with structured logging (Serilog)
  - Simulated processing flow (500ms placeholder for PH-002)
- ✅ US-002: Tray icon reflects state (FR-010)
  - State-based icon rendering using Segoe MDL2 Assets
  - Dynamic tooltip updates (German language)
  - Color-coded icons: Gray (Idle), Red (Recording), Blue (Processing)
  - Context menu with "Beenden" (Exit) option
- ✅ US-003: Hotkey conflict error dialog (FR-021)
  - ErrorDialog with Warning/Error/Info icon types
  - Hotkey conflict detection on registration failure
  - User-friendly German error message
  - Placeholder Settings button (PH-001, resolved in Iter-6)

**Tests:**
- ✅ Unit tests: 20 tests written and passing (11 StateMachine + 9 ConfigManager)
- ✅ Manual: Test script created (`docs/testing/manual-test-script-iter1.md`) with 8 test cases
- ⏳ Manual Windows testing: Pending user verification (requires .NET build environment)

**Metrics:**
- N/A (no performance targets this iteration)

**Implementation Details:**
- **Core modules:** StateMachine, ConfigManager, AppLogger, PathHelpers
- **Win32 interop:** P/Invoke for RegisterHotKey, UnregisterHotKey, WM_HOTKEY message handling
- **Configuration:** TOML-based config with minimal [hotkey] section (PH-003, full schema in Iter-5)
- **Data root:** Hardcoded to `%LOCALAPPDATA%\LocalWhisper` (PH-004, wizard in Iter-5)
- **Logging:** Serilog with file sink, 30-day rotation, 100MB retention per ADR-0003
- **Icons:** Segoe MDL2 Assets font rendered to bitmap for tray icon (DPI-independent)
- **Dependencies:** H.NotifyIcon.Wpf 2.0.125, Serilog 3.1.1, Tomlyn 0.17.0, xUnit 2.9.0

**Commits:**
- `build: initialize LocalWhisper solution with project structure`
- `feat(iter-1): add foundational models and exceptions`
- `feat(iter-1): implement AppLogger with Serilog and PathHelpers`
- `test(iter-1): add StateMachine unit tests (RED - TDD)`
- `feat(iter-1): implement StateMachine with state transitions (GREEN - TDD)`
- `test(iter-1): add ConfigManager unit tests and implement TOML config support`
- `feat(iter-1): implement IconResources, Win32Interop, and HotkeyManager`
- `feat(iter-1): implement WPF UI components and wire application`

**Notes:**
- State machine validates transitions per specification (prevents invalid jumps)
- TDD approach used for core logic (StateMachine, ConfigManager)
- Placeholder tracking system created (`docs/meta/placeholders-tracker.md`)
- All commits follow conventional commits specification
- Branch: `claude/explore-project-scope-01Ccjnpjp5gYzaHR5twVdfKU`

---

### Iteration 2: Audio Recording ✅ COMPLETE

**Implemented:**
- ✅ US-010: Audio recording via WASAPI (FR-011)
  - NAudio-based audio capture with WaveInEvent
  - 16kHz, mono, 16-bit PCM format (Whisper requirement)
  - Timestamp-based filenames: rec_YYYYMMDD_HHmmssfff.wav
  - Recording saved to tmp/ directory in data root
  - Fixed 500ms recording duration (placeholder for hold-to-talk in Iter-3)
- ✅ US-011: WAV file validation (FR-011)
  - RIFF header validation
  - Format specification checks (PCM, 16kHz, mono, 16-bit)
  - Invalid files moved to tmp/failed/ subdirectory
  - Detailed error messages for validation failures
- ✅ US-012: Microphone error handling (FR-021)
  - Microphone availability check on startup
  - Error dialog for missing microphone
  - Error dialog for recording failures
  - Graceful state recovery on errors

**Tests:**
- ✅ Unit tests: 18 tests written and passing (9 AudioRecorder + 9 WavValidator)
- ✅ Manual: WAV file inspection required (Windows environment needed)
- ⏳ Manual: Microphone error injection testing pending

**Metrics:**
- WAV file size: ~16 KB for 500ms recording (32 KB/second @ 16kHz mono 16-bit)

**Implementation Details:**
- **Core modules:** AudioRecorder, WavValidator
- **Audio library:** NAudio 2.2.1 for Windows audio APIs
- **Format:** WAV PCM (format code 1), 16000 Hz, 1 channel, 16 bits/sample
- **File naming:** Timestamp to millisecond precision prevents collisions
- **Validation:** Byte-level WAV header parsing and format verification
- **Error handling:** Microphone checks, validation failures, recording errors

**Commits:**
- `feat(iter-2): implement audio recording with NAudio (US-010)`
- `feat(iter-2): implement WAV file validation (US-011)`
- `feat(iter-2): integrate audio recording with state machine (US-010, US-012)`

**Notes:**
- TDD approach maintained (tests written first, then implementation)
- Fixed recording duration for Iteration 2 (will add hold-to-talk in Iter-3)
- WAV validation ensures compatibility with Whisper STT
- Microphone error handling provides clear user feedback
- Branch: `claude/iteration-2-audio-recording-01Ccjnpjp5gYzaHR5twVdfKU`

---

### Iteration 3: STT with Whisper (TBD)

**Implemented:**
- [TBD] US-020: Whisper CLI adapter (FR-012)
- [TBD] US-021: JSON parsing (CLI contract v1)
- [TBD] US-022: Timeout and exit code mapping (FR-021)
- [TBD] US-023: Model hash check placeholder (FR-017)

**Tests:**
- [TBD] BDD: @Iter-3 @FR-012 scenarios passing
- [TBD] Integration: Mock CLI tests

**Metrics:**
- [TBD] STT duration for 5s audio: ~1.2s (model: small)

**Notes:**
- [TBD] CLI subprocess approach per ADR-0002
- [TBD] 60-second timeout enforced

---

### Iteration 4: Clipboard + History + Flyout (TBD)

**Implemented:**
- [TBD] US-030: Clipboard write (FR-013)
- [TBD] US-031: History file with front-matter (FR-014)
- [TBD] US-032: Custom flyout notification (FR-015)
- [TBD] US-033: p95 latency measurement (NFR-001)
- [TBD] US-034: Flyout latency measurement (NFR-004)
- [TBD] US-035: End-to-end logging (FR-023)
- [TBD] US-036: Slug generation (FR-024)

**Tests:**
- [TBD] BDD: @Iter-4 E2E scenarios passing
- [TBD] Manual: p95 latency test (100 dictations)

**Metrics:**
- [TBD] **p95 latency:** X.Xs (target: ≤ 2.5s) ✓ or ✗
- [TBD] **Flyout latency:** XXXms (target: ≤ 0.5s) ✓ or ✗

**Notes:**
- [TBD] First complete E2E flow (hotkey → clipboard)
- [TBD] Custom flyout per ADR-0005

---

### Iteration 5: First-Run Wizard + Repair (TBD)

**Implemented:**
- [TBD] US-040: Wizard Step 1 - Data Root selection (FR-016)
- [TBD] US-041: Wizard Step 2 - Model verification with SHA-256 (FR-017)
- [TBD] US-042: Wizard Step 3 - Hotkey selection (FR-016)
- [TBD] US-043: Repair flow for missing data root (UC-003)
- [TBD] US-044: Wizard completion time measurement (NFR-004)
- [TBD] US-045: Wizard logging (NFR-006)
- [TBD] US-046: Error handling for write-protected folders (FR-021)

**Tests:**
- [TBD] BDD: @Iter-5 @FR-016 @FR-017 scenarios passing
- [TBD] Manual: Wizard timing test (< 2 min)

**Metrics:**
- [TBD] **Wizard completion time:** XX:XX (target: < 2 min) ✓ or ✗

**Notes:**
- [TBD] Wizard is 3 steps (autostart removed from scope)
- [TBD] SHA-256 hash verification implemented

---

### Iteration 6: Settings (TBD)

**Implemented:**
- [TBD] US-050: Settings - Hotkey change (FR-020)
- [TBD] US-051: Settings - Data Root change (FR-020)
- [TBD] US-052: Settings - Language/Format (FR-020)
- [TBD] US-053: Settings - Model check/reload (FR-020, FR-017)

**Tests:**
- [TBD] BDD: @Iter-6 @FR-020 scenarios passing
- [TBD] Manual: Settings persistence after restart

**Notes:**
- [TBD] Settings UI with TOML persistence

---

### Iteration 7: Optional Post-Processing (TBD)

**Implemented:**
- [TBD] US-060: Post-processing enable/disable (FR-022)
- [TBD] US-061: Fallback on post-processing error (FR-022)
- [TBD] US-062: "Do not change meaning" contract (FR-022)

**Tests:**
- [TBD] BDD: @Iter-7 @FR-022 scenarios passing
- [TBD] A/B comparison: STT vs. post-processed text

**Notes:**
- [TBD] LLM CLI integration (optional, user-configured)
- [TBD] Disabled by default

---

### Iteration 8: Stabilization + Reset + Logs (TBD)

**Implemented:**
- [TBD] US-070: Reset/Deinstall function (FR-019, UC-004)
- [TBD] US-071: Error scenarios handling (FR-021)
- [TBD] US-072: Logging hardening (FR-023, NFR-006)
- [TBD] US-073: p95 re-measurement (NFR-001)
- [TBD] US-074: README update
- [TBD] US-075: Changelog finalization
- [TBD] US-076: PR template

**Tests:**
- [TBD] Error matrix tested (all scenarios)
- [TBD] BDD: All scenarios (@Iter-1..8) passing
- [TBD] Soak test: 24-hour run, no memory leaks

**Metrics:**
- [TBD] **p95 latency (final):** X.Xs ✓ or ✗
- [TBD] **Memory footprint (idle):** XXX MB (target: < 150 MB) ✓ or ✗
- [TBD] **0 crashes** in error matrix ✓ or ✗

**Notes:**
- [TBD] All NFRs verified
- [TBD] v0.1 release ready

---

## Features Implemented

**Core Dictation:**
- ✓ Hold-to-Talk hotkey (configurable)
- ✓ Offline speech-to-text (Whisper)
- ✓ Instant clipboard write
- ✓ Auto-saved history (date-organized Markdown files)
- ✓ Custom flyout notification

**Setup & Configuration:**
- ✓ First-run wizard (3 steps)
- ✓ Model verification (SHA-256)
- ✓ Settings panel (hotkey, data root, language, format)
- ✓ Repair flow for missing/moved data root

**Advanced:**
- ✓ Optional post-processing (LLM formatting)
- ✓ Robust error handling
- ✓ Structured logging

**Portability:**
- ✓ Self-contained EXE (no installer)
- ✓ No admin rights required
- ✓ User-configurable data location

---

## Performance Results (Final)

**NFR-001: Latency**
- p50: [TBD] s
- p95: [TBD] s (target: ≤ 2.5s) [TBD: ✓ or ✗]
- p99: [TBD] s

**NFR-004: Usability**
- Flyout latency: [TBD] ms (target: ≤ 0.5s) [TBD: ✓ or ✗]
- Wizard completion: [TBD] min (target: < 2 min) [TBD: ✓ or ✗]

**NFR-003: Reliability**
- Crashes in error matrix: [TBD] (target: 0) [TBD: ✓ or ✗]

**NFR-006: Observability**
- All key events logged: [TBD: ✓ or ✗]

---

## Known Issues / Limitations

**v0.1 Limitations:**
- No autostart feature (removed from scope; manual workaround in README)
- No code signing (SmartScreen warning on first run)
- No auto-update mechanism
- No GPU acceleration (CPU-only Whisper)
- No built-in history search UI (use Windows File Explorer search)
- No "insert at cursor" (clipboard-only)

**Workarounds:**
- Autostart: User can manually create shortcut in Startup folder (see README)
- SmartScreen: Click "More info" → "Run anyway" (documented in README)

---

## Breaking Changes

None (this is the initial release).

---

## Upgrade Instructions

Not applicable (initial release).

---

## Documentation Updates

- [TBD] README.md: Installation, usage, troubleshooting
- [TBD] All specification documents finalized
- [TBD] All ADRs documented
- [TBD] BDD scenarios complete
- [TBD] Traceability matrix updated with code modules

---

## Contributors

- [Name]: Architecture, implementation, testing, documentation

---

## Next Steps (Post-v0.1)

**Potential v0.2 features:**
- Autostart option (deferred from v0.1)
- Code signing certificate
- GPU acceleration for faster STT
- Auto-update mechanism
- History search UI
- Multi-language model switching
- "Insert at cursor" functionality

---

**Release Date:** [TBD after Iteration 8]
**Git Tag:** `v0.1.0`
